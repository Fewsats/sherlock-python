# core


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

### Sherlock

This is the main class for the SDK. If a private key is not provided, we
will try to load it from the config file. If neither the private key nor
the config file is provided, we will generate a new one and store it in
the config file.

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L36"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock

>  Sherlock (priv:str='')

*Sherlock client class to interact with the Sherlock API.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>priv</td>
<td>str</td>
<td></td>
<td>private key</td>
</tr>
</tbody>
</table>

``` python
s = Sherlock(priv)
s
```

    Sherlock(pubkey=90ba884688884277e49080712f386eebc88806efa8345ca937f75fe80950156d)

### Me

Let’s do an authenticated request to verify we’re authenticated.

<details open class="code-fold">
<summary>Exported source</summary>

``` python
def _mk_headers(tok): return {"Authorization": f"Bearer {tok}"}
```

</details>

``` python
r = httpx.get(me_endpoint, headers=_mk_headers(s.atok))
r, r.json()
```

    (<Response [200 OK]>,
     {'logged_in': True,
      'email': 'jordi@fewsats.com',
      'public_key': '90ba884688884277e49080712f386eebc88806efa8345ca937f75fe80950156d'})

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L69"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.me

>  Sherlock.me ()

*Get authenticated user information*

``` python
s.me()
```

    {'logged_in': True,
     'email': 'jordi@fewsats.com',
     'public_key': '90ba884688884277e49080712f386eebc88806efa8345ca937f75fe80950156d'}

## API methods

### Claim account

Accounts created by AI Agents can link an email. After confirming the
account users will be able log in and use the web interface for
[Sherlock Domains](https://sherlockdomains.com).

An email cannot be claimed more than once.

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L85"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.claim_account

>  Sherlock.claim_account (email:str)

*Claim an account by linking an email address*

### Search domains

Search domains returns domain availability and its prices in USD cents.

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L106"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.search

>  Sherlock.search (q:str)

*Search for domains with a query. Returns prices in USD cents.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>q</td>
<td>str</td>
<td>query</td>
</tr>
</tbody>
</table>

``` python
sr = s.search("trakwiska")
# Don't print the whole lists
sr['available'] = sr['available'][:1]
sr['unavailable'] = sr['unavailable'][:1]
sr
```

    {'id': 'd1805b55-d448-4d1d-94ff-97e4e3e7642e',
     'created_at': '2025-03-18T08:58:56.382Z',
     'available': [{'name': 'trakwiska.net',
       'tld': 'net',
       'tags': [],
       'price': 1185,
       'currency': 'USD',
       'available': True}],
     'unavailable': []}

### Contact Information

Contact information is required for ICANN domain registration and
billing.

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L135"
target="_blank" style="float:right; font-size:smaller">source</a>

### Contact

>  Contact (first_name, last_name, email, address, city, state, postal_code,
>               country)

*Contact information for a domain purchase*

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L186"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.get_contact_information

>  Sherlock.get_contact_information ()

*Get the contact information for the Sherlock user.*

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L158"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.set_contact_information

>  Sherlock.set_contact_information (cfn:str='', cln:str='', cem:str='',
>                                        cadd:str='', cct:str='', cst:str='',
>                                        cpc:str='', ccn:str='')

*Set the contact information for the Sherlock user*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>cfn</td>
<td>str</td>
<td></td>
<td>contact first name</td>
</tr>
<tr>
<td>cln</td>
<td>str</td>
<td></td>
<td>contact last name</td>
</tr>
<tr>
<td>cem</td>
<td>str</td>
<td></td>
<td>contact email</td>
</tr>
<tr>
<td>cadd</td>
<td>str</td>
<td></td>
<td>contact address</td>
</tr>
<tr>
<td>cct</td>
<td>str</td>
<td></td>
<td>contact city</td>
</tr>
<tr>
<td>cst</td>
<td>str</td>
<td></td>
<td>contact state</td>
</tr>
<tr>
<td>cpc</td>
<td>str</td>
<td></td>
<td>contact postal code</td>
</tr>
<tr>
<td>ccn</td>
<td>str</td>
<td></td>
<td>contact country</td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L153"
target="_blank" style="float:right; font-size:smaller">source</a>

### Contact.is_valid

>  Contact.is_valid ()

*Check if the contact information is valid*

``` python
data = {
    "name": 'pol',
    "email": 'pol@sherlockdomains.com',
    "address": '123 Test St',
    "city": 'Test City',
    "state": 'CA',
    "postal_code": '12345',
    "country": 'US'
}
r = httpx.post(f"{API_URL}/api/v0/users/contact-information", json=data, headers=_mk_headers(s.atok))
r, r.text
```

    (<Response [422 Unprocessable Content]>,
     '{"detail": [{"type": "missing", "loc": ["body", "data", "first_name"], "msg": "Field required"}, {"type": "missing", "loc": ["body", "data", "last_name"], "msg": "Field required"}]}')

``` python
info = {
    "first_name": "Test",
    "last_name": "User",
    "email": "test@example.com",
    "address": "123 Test St",
    "city": "Test City",
    "state": "CA",
    "country": "US",
    "postal_code": "12345",
}  

c = Contact(**info)
c, c.is_valid()
```

    (Contact(first_name='Test', last_name='User', email='test@example.com', address='123 Test St', city='Test City', state='CA', postal_code='12345', country='US'),
     True)

``` python
r = s.set_contact_information(
    cfn=info['first_name'],
    cln=info['last_name'],
    cem=info['email'],
    cadd=info['address'],
    cct=info['city'],
    cst=info['state'],
    cpc=info['postal_code'],
    ccn=info['country']
)
r
```

    {'message': 'Contact information updated successfully'}

``` python
r = s.get_contact_information()
r
```

    {'first_name': 'Test',
     'last_name': 'User',
     'address': '123 Test St',
     'city': 'Test City',
     'state': 'CA',
     'postal_code': '12345',
     'country': 'US',
     'email': 'test@example.com'}

### Purchase a domain

A purchase needs to be linked to a search id. The purchase flow
implements the [L402 protocol](https://github.com/l402-protocol/l402).
The flow has two steps:

1.  Get available payment options for a domain
2.  Get payment details (checkout URL for credit card, invoice for
    Lightning Network) so it can be completed outband.

``` python
pd = _get_offers_payload("trakwiska.com", c, sr['id'])
pd
```

    {'domain': 'trakwiska.com',
     'contact_information': {'first_name': 'Test',
      'last_name': 'User',
      'email': 'test@example.com',
      'address': '123 Test St',
      'city': 'Test City',
      'state': 'CA',
      'postal_code': '12345',
      'country': 'US'},
     'search_id': 'd1805b55-d448-4d1d-94ff-97e4e3e7642e'}

``` python
r = httpx.post(get_offers_endpoint, json=pd, headers=_mk_headers(s.atok))
r, r.json()
```

    (<Response [402 Payment Required]>,
     {'version': '0.2.1',
      'payment_request_url': 'https://api.sherlockdomains.com/api/v0/payments/l402/payment_request',
      'payment_context_token': '90ba884688884277e49080712f386eebc88806efa8345ca937f75fe80950156d',
      'offers': [{'id': 'c377d60a-af98-48fd-a258-70c22de2d95c',
        'title': 'trakwiska.com',
        'description': 'Purchase trakwiska.com for 11.05 USD',
        'type': 'one-time',
        'amount': 1105,
        'currency': 'USD',
        'payment_methods': ['credit_card', 'lightning']}]})

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L242"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.get_purchase_offers

>  Sherlock.get_purchase_offers (sid:str, domain:str, c:__main__.Contact)

*Request available payment options for a domain.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>sid</td>
<td>str</td>
<td>search id</td>
</tr>
<tr>
<td>domain</td>
<td>str</td>
<td>domain</td>
</tr>
<tr>
<td>c</td>
<td>Contact</td>
<td>contact information</td>
</tr>
</tbody>
</table>

Requesting a purchase will return a list of available offers and payment
methods.

``` python
ofs = s.get_purchase_offers(sr['id'], "trakwiska.com")
ofs
```

    {'version': '0.2.1',
     'payment_request_url': 'https://api.sherlockdomains.com/api/v0/payments/l402/payment_request',
     'payment_context_token': '90ba884688884277e49080712f386eebc88806efa8345ca937f75fe80950156d',
     'offers': [{'id': '533f89b7-67fa-48fe-9517-5ae32ce89d65',
       'title': 'trakwiska.com',
       'description': 'Purchase trakwiska.com for 11.05 USD',
       'type': 'one-time',
       'amount': 1105,
       'currency': 'USD',
       'payment_methods': ['credit_card', 'lightning']}]}

In order to pay for the domain you will have to request the payment
details of the offer you want to pay for.

``` python
data = {
    "offer_id": first(ofs['offers'])['id'],
    "payment_method": 'credit_card',
    "payment_context_token": ofs['payment_context_token']
}
r = httpx.post(ofs['payment_request_url'], json=data)
r, r.json()
```

    (<Response [200 OK]>,
     {'payment_method': {'checkout_url': 'https://checkout.stripe.com/c/pay/cs_live_a1Om85Efvv1lgfE8BbhUNibQyzwoEfG8qvKPeOVoSt5tv0wx2rxcgiKofV#fidkdWxOYHwnPyd1blppbHNgWjA0S3VzXDdBbTFNVlJzfDVRQVQ2dVdBTnJTSH1QMGs2dHRsanJMbkY0PTxKbUtRaWowT2NwMGM8RlVBbGRqSWo3UFYwcVdqR3F9N2BtM2ZTPXc1Z3dQXGc2NTVPYVVSQkM8bycpJ2N3amhWYHdzYHcnP3F3cGApJ2lkfGpwcVF8dWAnPyd2bGtiaWBabHFgaCcpJ2BrZGdpYFVpZGZgbWppYWB3dic%2FcXdwYHgl',
       'lightning_invoice': None},
      'expires_at': '2025-01-14T04:04:35.484Z'})

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L283"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.get_payment_details

>  Sherlock.get_payment_details (prurl:str, oid:str, pm:str, pct:str)

*Get payment details for an offer.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>prurl</td>
<td>str</td>
<td>payment request url</td>
</tr>
<tr>
<td>oid</td>
<td>str</td>
<td>offer id</td>
</tr>
<tr>
<td>pm</td>
<td>str</td>
<td>payment method</td>
</tr>
<tr>
<td>pct</td>
<td>str</td>
<td>payment context token</td>
</tr>
</tbody>
</table>

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L300"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.request_payment_details

>  Sherlock.request_payment_details (sid:str, domain:str,
>                                        payment_method:str='credit_card',
>                                        contact:__main__.Contact=None)

*Request payment information for purchasing a domain. Returns the
details needed to complete the payment (like a checkout URL).*

<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 25%" />
<col style="width: 34%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>sid</td>
<td>str</td>
<td></td>
<td>search id</td>
</tr>
<tr>
<td>domain</td>
<td>str</td>
<td></td>
<td>domain</td>
</tr>
<tr>
<td>payment_method</td>
<td>str</td>
<td>credit_card</td>
<td>payment method {‘credit_card’, ‘lightning’}</td>
</tr>
<tr>
<td>contact</td>
<td>Contact</td>
<td>None</td>
<td>contact information</td>
</tr>
</tbody>
</table>

## DNS methods

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L332"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.domains

>  Sherlock.domains ()

*List of domains owned by the authenticated user*

``` python
ds = s.domains()
ds
```

    [{'id': 'd9b2cc30-c15d-44b9-9d39-5d33da504484',
      'domain_name': 'h402.org',
      'created_at': '2024-12-28T18:58:49.899Z',
      'expires_at': '2024-12-31T18:58:42Z',
      'auto_renew': False,
      'locked': True,
      'private': True,
      'nameservers': [],
      'status': 'active'}]

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L359"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.dns_records

>  Sherlock.dns_records (domain_id:str)

*Get DNS records for a domain.*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>domain_id</td>
<td>str</td>
<td>domain id</td>
</tr>
</tbody>
</table>

``` python
did = first(ds)['id']
rs = s.dns_records(did)
rs
```

    {'domain': 'h402.org',
     'records': [{'id': '8c1df0e3ad7ff4b30695a11e20d84b72',
       'type': 'A',
       'name': 'h402.org',
       'value': '76.76.21.21',
       'ttl': 3600}]}

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L386"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.create_dns

>  Sherlock.create_dns (domain_id:str, type:str='TXT', name:str='test',
>                           value:str='test-1', ttl:int=3600)

*Create a new DNS record*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>domain_id</td>
<td>str</td>
<td></td>
<td>domain id</td>
</tr>
<tr>
<td>type</td>
<td>str</td>
<td>TXT</td>
<td>type</td>
</tr>
<tr>
<td>name</td>
<td>str</td>
<td>test</td>
<td>name</td>
</tr>
<tr>
<td>value</td>
<td>str</td>
<td>test-1</td>
<td>value</td>
</tr>
<tr>
<td>ttl</td>
<td>int</td>
<td>3600</td>
<td>ttl</td>
</tr>
</tbody>
</table>

``` python
entry = s.create_dns(
    domain_id=did,
    type="TXT",
    name="test-sherlock",  # This will create test-sherlock.yourdomain.com
    value="hello-world",   # The actual text content
    ttl=3600              # Time to live in seconds
)

created_record_id = first(entry['records'])['id']
created_record_id, entry
```

    ('b22820c45b6f2a48461c3a52ca486b5a',
     {'domain': 'h402.org',
      'records': [{'id': 'b22820c45b6f2a48461c3a52ca486b5a',
        'type': 'TXT',
        'name': 'test-sherlock',
        'value': 'hello-world',
        'ttl': 3600}]})

``` python
s.dns_records(did)
```

    {'domain': 'h402.org',
     'records': [{'id': '8c1df0e3ad7ff4b30695a11e20d84b72',
       'type': 'A',
       'name': 'h402.org',
       'value': '76.76.21.21',
       'ttl': 3600},
      {'id': 'b22820c45b6f2a48461c3a52ca486b5a',
       'type': 'TXT',
       'name': 'test-sherlock.h402.org',
       'value': 'hello-world',
       'ttl': 3600}]}

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L420"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.update_dns

>  Sherlock.update_dns (domain_id:str, record_id:str, type:str='TXT',
>                           name:str='test-2', value:str='test-2', ttl:int=3600)

*Update a DNS record*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>domain_id</td>
<td>str</td>
<td></td>
<td>domain id</td>
</tr>
<tr>
<td>record_id</td>
<td>str</td>
<td></td>
<td>record id</td>
</tr>
<tr>
<td>type</td>
<td>str</td>
<td>TXT</td>
<td>type</td>
</tr>
<tr>
<td>name</td>
<td>str</td>
<td>test-2</td>
<td>name</td>
</tr>
<tr>
<td>value</td>
<td>str</td>
<td>test-2</td>
<td>value</td>
</tr>
<tr>
<td>ttl</td>
<td>int</td>
<td>3600</td>
<td>ttl</td>
</tr>
</tbody>
</table>

``` python
updated_record = s.update_dns(
    domain_id=did,
    record_id=entry['records'][0]['id'],
    type="TXT",
    name="test-sherlock",
    value="hello-world-updated",
    ttl=3600
)
updated_record_id = first(updated_record['records'])['id']
updated_record_id, updated_record
```

    ('3944584c93667d49c774e7823a039cd8',
     {'domain': 'h402.org',
      'records': [{'id': '3944584c93667d49c774e7823a039cd8',
        'type': 'TXT',
        'name': 'test-sherlock',
        'value': 'hello-world-updated',
        'ttl': 3600}]})

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L460"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.delete_dns

>  Sherlock.delete_dns (domain_id:str, record_id:str)

*Delete a DNS record*

<table>
<thead>
<tr>
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>domain_id</td>
<td>str</td>
<td>domain id</td>
</tr>
<tr>
<td>record_id</td>
<td>str</td>
<td>record id</td>
</tr>
</tbody>
</table>

``` python
s.delete_dns(did, updated_record_id)
```

    {'domain': 'h402.org', 'deleted_records': ['3944584c93667d49c774e7823a039cd8']}

We expose Sherlock’s core functionality as tools for AI agents. Note
that payment handling for L402 offers requires additional tools like
`fewsats.Client().pay`.

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L484"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.as_tools

>  Sherlock.as_tools ()

*Return the Sherlock class as a list of tools ready for agents to use*

``` python
s.as_tools().map(lambda t: t.__name__)
```

    (#10) ['_me','_set_contact_information','_get_contact_information','_search','_purchase_domain','_domains','_dns_records','_create_dns_record','_update_dns_record','_delete_dns_record']

## CLI

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L505"
target="_blank" style="float:right; font-size:smaller">source</a>

### Sherlock.as_cli

>  Sherlock.as_cli ()

*Return the Sherlock class as a list of tools ready for agents to use*

You can use the Sherlock class as a CLI tool.

``` bash
❯ sherlock
usage: sherlock [-h] {me,set_contact_information,get_contact_information,search,purchase_domain,domains,dns_records,create_dns,update_dns,delete_dns} ...

positional arguments:
  {me,set_contact_information,get_contact_information,search,purchase_domain,domains,dns_records,create_dns,update_dns,delete_dns}
    me                  Get authenticated user information
    set_contact_information
                        Set the contact information for the Sherlock user
    get_contact_information
                        Get the contact information for the Sherlock user.
    search              Search for domains with a query. Returns prices in USD cents.
    purchase_domain     Request payment information for purchasing a domain. Returns the details needed to complete the payment (like a checkout URL).
    domains             List of domains owned by the authenticated user
    dns_records         Get DNS records for a domain.
    create_dns          Create a new DNS record
    update_dns          Update a DNS record
    delete_dns          Delete a DNS record

options:
  -h, --help            show this help message and exit
```

------------------------------------------------------------------------

<a
href="https://github.com/fewsats/sherlock-python/blob/main/sherlock/core.py#L521"
target="_blank" style="float:right; font-size:smaller">source</a>

### main

>  main ()

*CLI interface for Sherlock*
